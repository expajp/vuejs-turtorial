# Enter/Leave とトランジション一覧

## 概要
* Vueは、DOMからアイテムが追加・更新・削除されたときにトランジション効果を施す機能を複数提供している
* 具体的には以下の通り
    * 自動的にCSSアニメーションを適用
    * Animate.cssのようなサードパーティ製CSSライブラリとの連携方法を提供
    * トランジションフック中はJSで直接DOM操作を実行可能
    * Velocity.jsのようなサードパーティ製JSライブラリと連携
* この章では、リストのトランザクションを取り扱う

## 単一要素/コンポーネントのトランジション
* Vueはtransitionラッパーコンポーネントを提供している
* 以下の要素やコンポーネントにentering/leavingトランジション
    * 条件付き描画（`v-if`）
    * 条件付き表示（`v-show`）
    * 動的コンポーネント
    * コンポーネントルートノード
* transitionコンポーネントにラップされた要素が挿入あるいは削除されるときに次の処理が行われる
    * 対象の要素にアニメーションが行われるかどうか自動的に察知
        * ない場合は、Vue側でトランジション用のクラスを付与
    * トランジションコンポーネントがJSフックを提供している場合、発火させる
    * CSSアニメーションもJSフックも提供されない場合、DOM操作を次のフレームで実行する

### トランジションクラス
* enter/leaveアクションの際にVueが自動的に付与するクラスが6つある
* v-enter
    * enterの開始時
* v-enter-active
    * enterの実行中
    * 要素挿入前に追加され、トランジションが終了すると削除される
    * トランジションの開始の期間やアクションからの遅延、それからイージングカーブに使用可能
* v-enter-to
    * 2.1.8以降
    * enterの終了状態なので、v-enterと入れ替わりになる
    * 要素追加後の1フレームで実行される
    * 追加されたってことは需要があったってことなんだろうが……JSのフックじゃあるまいし？
* v-leave
    * トランジションの終了開始時の1フレームで実行される
    * これもどう使うんだろうか……
* v-leave-active
    * leaveの実行中
    * 概要はだいたいv-enter-activeと同じ
* v-leave-to
    * 2.1.8以降
    * これも、終了の瞬間の1フレーム
    * やはり使いみちはわからない
* 各クラスはトランジション名が先頭につく
    * トランジション名：`transition`要素の`name`属性値
        * nameがhogeならhoge-enterのようになる
    * nameがない場合は、v-xxx
* イージングカーブとは、透過度などの変化の速さの変遷

### CSSトランジション
* トランジションを実現する最もシンプルな方法
* とりあえず例を見よう

### CSSアニメーション
* CSSアニメーションはトランジション同様に適用される
    * そもそもトランジションとアニメーションは違うのである
* トランジションとアニメーションの違い
    * トランジション
        * なんらかのイベントをフックにして起動する
        * ループしない
        * 戻るアニメーションは自動で付く
    * アニメーション
        * ウィンドウ読み込み即実行が可能
        * ループ可能
        * keyframesで細かい設定が可能
* v-enterは要素の挿入直後には消えないが、animationedイベント時には削除される
* これも例を見よう

### カスタムトランジションクラス
* transition要素の属性として、カスタムトランジションクラスを指定できる
    * なんでわざわざこんなことができるようにしてあるかと言えば、アニメーションライブラリとの併用のため
    * というわけで、標準では使わないほうが良いです
* 該当する属性は以下
    * enter-class
    * enter-active-class
    * enter-to-class
    * leave-class
    * leave-active-class
    * leave-to-class

### トランジションとアニメーションを両方使う
* Vueはトランジションorアニメーションが終了したことを把握するためのイベントリスナを必要とする
    * イベントはtransitionend, animationend
    * ハイフンはないのか
    * 一方しか使わないときはVueが自動的に判断してくれる
* 同じ要素に両方を使う場合は、type属性でanimationまたはtransitionを明示する

### 明示的なトランジション期間の設定
* Vueはトランジション終了を基本的には自分で見つける
    * 見つける＝対応したイベントを起こす
* デフォルトでは、ルート要素にtransitionendイベントが起こるのを待つ
* これが嬉しくない場合がある
    * 内部のトランジションが遅延する場合
    * ルートよりも長いトランジション期間を設けている場合
* transition要素のduration属性で、ミリ秒単位で設定が可能
    * また、`{ enter: 50, leave: 100 }`のような形で活性化と終了時の時間を別々に設定することも可能

### JavaScriptフック
* 属性でJSフックを定義することができる
* フックはCSSのトランジションやアニメーションと併用可能
* JSのみを利用したトランジションを行う場合、doneコールバックをenterとleaveの両方で呼ぶ必要がある
    * 呼ばない場合はフックが同期的に呼ばれる＝1回呼ばれるだけなのですぐ終わる
    * コールバックはただ呼ぶだけで良い
    * VelocityJSなら終了時のコールバックを指定できるので、そこで`{ complete: done }`とすればよい
* JSのみを利用したトランジションを行う場合は`v-bind:css="false"`を推奨
* とりあえず例を見よう

## 初期描画時のトランジション
* 描画時のトランジションはappear属性で定義する
* デフォルトではenteringとleavingのための属性に定義されたCSSが適用される
    * カスタムを適用することももちろん可能
* JSフックもある

## 要素間のトランジション
* v-ifを使った出しわけでもトランジションは普通に使うことができる
* 同じタグ名を持つ要素がトグルするときは**ちゃんとkeyを指定してどの要素なのかをVueに伝える**必要がある
    * transitionコンポーネント内の要素を常に区別するのはGood custom
    * `v-bind`でkeyを指定することもできる
* どうでも良いけど動作を定義するサンプルコードがないから試しづらい

### トランジションモード
* 2つのボタンの入れ替えを行うような状況で、トランジション中に両方のボタンが表示されてしまう
    * これは、enteringとleavingが同時に起きるtransitionの仕様によるもの
    * ボタンを絶対位置で指定したりスライドするようなアクションの場合はこれで良い
* この問題には回避方法が用意されている
    * **enteringとleavingが順に起きる**
    * transition要素のmode属性に`out-in, in-out`を指定するだけでよい
    * 普通のトランジションとは違う効果が起きるので、試行錯誤の段階で試してみるとよい

## コンポーネント間のトランジション
* key要素がいらないのでとても単純
    * 動的コンポーネントでラップするだけ
    * タブインタフェースを実現してたあれ
    * transitionでcomponentを囲む

## リストトランジション
* リストをv-forで描画した場合などのため、`transition-group`を使うことができる
* transition要素とは異なり、実際に要素を描画する
    * ベースは`span`要素
* トランジションモードの利用は不可
    * というか、使える状況がない
* 中の要素はすべてkeyを持つ必要がある

### リストEntering/Leavingトランジション
* 説明は不要、コードを見る
* 追加してない要素はトランジションしないが、これは後の工程で修正

### リスト移動トランジション
* `transition-group`コンポーネントではenteringやleavingだけでなく**それによって影響を受ける別要素の位置の変化もアニメーションできる**
* 新しく知ることはitemの位置が変わるときにv-moveクラスが追加されるということだけ
    * あとは他のクラス同様
    * つまり、接頭辞はtransition-groupのname属性に一致するし、move-classで属性指定が可能

### スタッガリングリストトランジション
* data属性を通してJSトランジションとやり取りを行うことでリスト内の遷移をずらすことが可能
    * どういうことなの
    * とりあえず実装してみる
* 実装を見るとわかる
    * キモは`v-bind:data-index="index"`としているところ
    * これで、出力されるliのdata属性のindexの値が**項目ごとに別々になる**
    * これを利用して、変化時のdelayの値を調整している
        * data属性はdatasetプロパティに格納されている模様
        * `item.dataset.index`でインデックスを取得している箇所があるのがわかる
